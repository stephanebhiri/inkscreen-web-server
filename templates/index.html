<!DOCTYPE html>
<html>
<head>
    <title>Ink Screen Manager - Ultimate</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Cache buster timestamp: 2025-08-19-14-45 -->
    <link rel="stylesheet" href="/static/css/style.css?v={{ asset_v }}">
    <link rel="stylesheet" href="/static/css/style_responsive.css?v={{ asset_v }}">
</head>
<body>
    <button class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Folders</h2>
            <p class="sidebar-subtitle">Manage your image collections</p>
            <button class="new-folder-btn" onclick="showNewFolderModal()">
                <span>+</span>
                New Folder
            </button>
        </div>
        <div class="folders-container">
            <div id="folderTree" class="folder-tree"></div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="header">
            <div class="breadcrumb" id="breadcrumb">
                <a href="#" class="breadcrumb-item" onclick="loadFolder('')">Home</a>
            </div>
            <div class="controls">
                <button class="btn btn-primary" onclick="console.log('Upload button clicked'); document.getElementById('fileInput').click();">
                    üì§ Upload Images
                </button>
                <div class="drop-pill" id="dropPill" title="Drop files or click to upload" onclick="document.getElementById('fileInput').click()">
                    ‚á™ Drop Here
                </div>
                <button class="btn btn-secondary" onclick="showPlaylistSettings()">
                    ‚öôÔ∏è Settings
                </button>
                <button class="btn btn-success" id="playBtn" onclick="toggleSlideshow()">
                    ‚ñ∂Ô∏è Play
                </button>
                <button class="btn btn-danger" id="stopBtn" onclick="stopSlideshow()" style="display: none;">
                    ‚èπÔ∏è Stop
                </button>
                <button class="btn btn-secondary" onclick="refreshStatus()">
                    üîÑ Refresh
                </button>
                <button class="btn btn-secondary" onclick="refreshThumbnails(currentFolder)">
                    üßπ Refresh Thumbnails
                </button>
            </div>
        </div>
        
        <div class="status-bar" id="statusBar">
            <div class="status-content">
                <div class="status-item">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span id="statusText">Idle</span>
                </div>
                <div class="status-item">
                    <span>üîÅ Loop: <span id="loopStatus">Off</span></span>
                </div>
                <div class="status-item">
                    <span>üîÄ Shuffle: <span id="shuffleStatus">Off</span></span>
                </div>
                <div class="status-item">
                    <span>üî¢ <span id="playlistProgress">-</span></span>
                </div>
                <div class="status-item">
                    <span>‚è±Ô∏è Next in: <span id="nextChange">-</span></span>
                </div>
                <div class="status-item">
                    <span>üîã ESP32: <span id="esp32Battery">-</span></span>
                </div>
                <div class="status-item">
                    <span>üì∂ WiFi: <span id="esp32WiFi">-</span></span>
                </div>
                <div class="status-item">
                    <span>üñ•Ô∏è Server: <span class="health-dot" id="healthIndicator" title="Unknown"></span></span>
                </div>
                <div class="status-item" title="Last cleanup dynamic count">
                    <span>üßπ Dyn: <span id="dynamicCleanedCount">-</span></span>
                </div>
            </div>
            <div class="now-playing" id="nowPlaying">
                <div style="border-bottom: 1px solid rgba(102, 126, 234, 0.3); padding-bottom: 10px; margin-bottom: 15px;">
                    <strong>Playing from:</strong> <span id="playingFolder" style="color: #667eea;">-</span>
                </div>
                <div class="playing-content">
                    <div class="playing-item">
                        <h4>Now Playing</h4>
                        <img id="currentThumbnail" class="playing-thumbnail" src="" alt="Current">
                        <div class="playing-name" id="currentImageName">-</div>
                    </div>
                    <div class="next-arrow">‚Üí</div>
                    <div class="playing-item">
                        <h4>Next</h4>
                        <img id="nextThumbnail" class="playing-thumbnail" src="" alt="Next">
                        <div class="playing-name" id="nextImageName">-</div>
                        <button class="btn btn-primary" style="margin-top: 10px;" onclick="pushNextNow()">Push Next Now</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Global Drag & Drop Overlay -->
        <div id="dropOverlay" class="drop-overlay" style="display:none;">
            <div class="drop-overlay-inner">
                <div class="drop-icon">üì§</div>
                <div class="drop-title">Drop images to upload</div>
                <div class="drop-subtitle">JPG and PNG supported</div>
            </div>
        </div>
        
        <div class="image-grid" id="imageGrid"></div>
    </div>
    
    <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
    
    <!-- Upload Progress -->
    <div class="upload-progress" id="uploadProgress" style="display: none; position: fixed; top: 20px; right: 20px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000;">
        <div style="margin-bottom: 8px; font-weight: 500;">Uploading images...</div>
        <div class="progress-bar" style="width: 200px; height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden;">
            <div class="progress-fill" id="uploadProgressFill" style="height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 10px; text-align: center; line-height: 20px; color: white; font-size: 12px; font-weight: 500; transition: width 0.3s;">0%</div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <span class="notification-icon" id="notificationIcon">‚úì</span>
            <div class="notification-text">
                <div class="notification-title" id="notificationTitle">Success</div>
                <div class="notification-message" id="notificationMessage">Action completed</div>
                <div class="notification-progress" id="notificationProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="notificationProgressFill">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal" id="newFolderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Folder</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Folder Name:</label>
                    <input type="text" id="newFolderName" placeholder="Enter folder name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="createNewFolder()">Create</button>
                <button class="btn btn-secondary" onclick="closeModal('newFolderModal')">Cancel</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Playlist Settings</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Interval (seconds):</label>
                    <input type="number" id="intervalInput" min="1" value="300">
                </div>
                <div class="form-group">
                    <label>Loop:</label>
                    <div class="toggle-switch" id="loopToggle" onclick="toggleSwitch(this)"></div>
                </div>
                <div class="form-group">
                    <label>Shuffle:</label>
                    <div class="toggle-switch" id="shuffleToggle" onclick="toggleSwitch(this)"></div>
                                <div class="form-group">
                    <label>Recursive Play:</label>
                    <div class="toggle-switch" id="recursiveToggle" onclick="toggleSwitch(this)"></div>
                </div>
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="descriptionInput" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="savePlaylistSettings()">Save</button>
                <button class="btn btn-secondary" onclick="closeModal('settingsModal')">Cancel</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="moveModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Move Image</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select Destination Folder:</label>
                    <select id="destinationFolder"></select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="confirmMove()">Move</button>
                <button class="btn btn-secondary" onclick="closeModal('moveModal')">Cancel</button>
            </div>
        </div>
    </div>
    
    <script src="/static/js/app.js?v={{ asset_v }}"></script>
</body>
</html>
